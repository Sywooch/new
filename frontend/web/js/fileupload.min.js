$(document).ready(function(){var loader=$(document).find("#images-images-fileupload"),targetUrl="/images/uploaded-images",ad_id=$(document).find("#marker").val(),table=loader.find("table"),imageContainer=loader.find("#preview-container");loader.fileupload({acceptFileTypes:/(\.|\/)(gif|jpe?g|png)$/i,dropZone:$("#dropzone")}).bind("fileuploadalways",function(e,data){$(this).find("li.template-download:eq(2)").after('<div class="clearfix"></div>')}).bind("fileuploaddestroy",function(e,data){$(this).find(".load-warning").remove()}).bind("fileuploadprocessfail",function(e,data){console.log(data.files);if($("*").is(".load-warning")){return false}else{$(this).append('<p class="load-warning">'+'<i class="fa fa-exclamation-triangle" aria-hidden="true"></i>'+"Превышено максимальное количество файлов!</p>")}});$.ajax({url:targetUrl,dataType:"json",method:"post",data:{id:ad_id},beforeSend:function(){},error:function(){},success:function(data){if(data){$.each(data.images,function(i,val){if($("*").is(table)){table.append('<tr class="template-download fade in">'+'<td><span class="preview">'+'<a href="'+val.path+val.filename+'" title="'+val.filename+'" download="'+val.filename+'" data-gallery=""><img src="'+val.path+val.filename+'"></a>'+"</span></td>"+'<td><p class="name">'+'<a href="'+val.path+val.filename+'" title="'+val.filename+'" download="'+val.filename+'" data-gallery="">'+val.filename+"</a>"+"</p></td>"+'<td><span class="size">'+val.size+"</span></td>"+"<td>"+'<button class="btn btn-danger delete" data-type="POST" data-url="/images/image-delete?name='+val.filename+'">'+'<i class="glyphicon glyphicon-trash"></i>'+"<span>Удалить</span></button>"+'<input class="toggle" name="delete" value="1" type="checkbox">'+"</td>"+"</tr>")}if($("*").is(imageContainer)){console.log(imageContainer);imageContainer.find(".files").append('<div class="col-sm-4 template-download fade in">'+'<div class="panel panel-default">'+'<ul class="list-unstyled">'+'<li class="preview">'+'<img src="'+val.path+val.filename+'">'+"</li>"+'<li class="buttons">'+'<button class="btn btn-danger delete" title="Удалить" data-type="POST" data-url="/images/image-delete?name='+val.filename+'"><span class="glyphicon glyphicon-remove" aria-hidden="true"></span></button>'+"</li>"+"</ul>"+"</div>"+"</div>")}})}else{console.log(data)}},complete:function(){}});loader.on("click",".cancel",function(){loader.find(".load-warning").remove()});$(document).bind("dragover",function(e){var dropZone=$("#dropzone"),timeout=window.dropZoneTimeout;if(timeout){clearTimeout(timeout)}else{dropZone.addClass("in")}var hoveredDropZone=$(e.target).closest(dropZone);dropZone.toggleClass("hover",hoveredDropZone.length);window.dropZoneTimeout=setTimeout(function(){window.dropZoneTimeout=null;dropZone.removeClass("in hover")},100)}).bind("drop dragover",function(e){e.preventDefault()})});